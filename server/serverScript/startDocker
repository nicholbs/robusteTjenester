#!/bin/bash

#Finnes volumene fra glusterfs, altså bf_config og bf_image


finnesDatabase=$(curl http://localhost:8080/health)
finnesConfig=false
SUB='{'

#if [[ $finnesDatabase == "$SUB"* ]]
#then
#	echo "den finneeees"
#else
#	echo "ikke finnes"
#fi
	

#echo $finnesDatabase

while ! $finnesConfig;
do
if [[ $finnesDatabase == "$SUB"* ]];
then
	MountedVolumes=$(df -h | awk '{print $6}'| grep '/bf_*' | tr '\n' ' ')
	if [ "${MountedVolumes}" == "/bf_config /bf_images " ]
	then
		echo "fant mounta volumes"
		sudo systemctl start docker
		finnesConfig=true
	else
		echo "fant ikke mounta volumes"
	fi

else
	echo "den finnes ikke"
	sleep 2
fi
done


#Kyrre sin metode for å starte docker etter at volum er mounter på serverene nedenfor:
#while ! mount -t glusterfs server1:/bf_config /bf_config; do
#sleep 2
#done

#mount -t glusterfs server1:/bf_images /bf_images

#sleep 2

#systemctl start docker
